<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<script async="" src="files/analytics.js"></script><script src="files/Chart.bundle.js"></script><style type="text/css">/* Chart.js */
	@-webkit-keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}@keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}.chartjs-render-monitor{-webkit-animation:chartjs-render-animation 0.001s;animation:chartjs-render-animation 0.001s;}</style>
	<script src="./files/utils.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
	<style>
		canvas{
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>
</head>

<body>	
	<canvas id="canvas" class="chartjs-render-monitor" style="display: block; width: 100%; height: 90vh;"></canvas>	

	<script>		
		var config = {
			type: 'line',
			data: {
				labels: [],
				datasets: [
				{
					label: 'Thermometer',
					backgroundColor: window.chartColors.red,
					borderColor: window.chartColors.red,
					data: [],
					fill: false,
				}, 
				{
					label: 'ECG',
					backgroundColor: window.chartColors.blue,
					borderColor: window.chartColors.blue,
					data: [],
					fill: false,
				},
				{
					label: 'Oximeter',
					backgroundColor: window.chartColors.green,
					borderColor: window.chartColors.green,
					data: [],
					fill: false,
				}, 
				{
					label: 'Bpms',
					backgroundColor: window.chartColors.yellow,
					borderColor: window.chartColors.yellow,
					data: [],
					fill: false,
				}, 
				{
					label: 'Bpmd',
					backgroundColor: window.chartColors.orange,
					borderColor: window.chartColors.orange,
					data: [],
					fill: false,
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Evaluated packets'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{						
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Time'
						}
					}],
					yAxes: [{
						ticks: {
							suggestedMin: 0,
							suggestedMax: 100
						},
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Patien risk'
						}
					}]
				}
			}
		};

		var socket = io();

		window.onload = function() {
			var ctx = document.getElementById('canvas').getContext('2d');			
			window.myLine = new Chart(ctx, config);			
		};

		function split_packet(packet) {
			var sensors = packet.split('/');
			// console.log(sensors);
			var raw_packets = []
			var evaluated_packets = []
			var patient_status = sensors[sensors.length -1];
			for(var i=0; i < 5; i++) {
				var evl_pack = sensors[i].split('=')[0]
				var raw_pack = sensors[i].split('=')[1]
				
				raw_packets.push(raw_pack);
				evaluated_packets.push(evl_pack);
			}

			return {raw: raw_packets, eval: evaluated_packets, patient_status: patient_status};
		}

		function get_current_time() {
			var date = new Date;			
			var hour = date.getHours();
			var minutes = date.getMinutes();
			var seconds = date.getSeconds();
			

			return (hour + ':' + minutes + ':' + seconds);
		}

		function update_sensors_chart(packet) {			
			var time_stamp = get_current_time();

			for(var i=0; i < 5; i++){
				config.data.datasets[i].data.push(packet.eval[i]);
			}
			config.data.labels.push(time_stamp);
			window.myLine.update();
		}
		
		socket.on('chat', function(msg) {			
			update_sensors_chart(split_packet(msg));
			
		});

		
	</script>

</body>
</html>
